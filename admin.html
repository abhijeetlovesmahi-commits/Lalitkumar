<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard | The Lalit School</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Poppins:wght@300;400;500&display=swap');
    :root { --gold: #D4AF37; --glass: rgba(255, 255, 255, 0.05); }
    body { margin: 0; font-family: 'Poppins', sans-serif; background: #000c1a; color: white; padding: 20px; }
    h1 { font-family: 'Cinzel'; color: var(--gold); text-align: center; }
    .table-container { overflow-x: auto; width: 100%; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; background: var(--glass); border: 1px solid var(--gold); }
    th { background: rgba(212, 175, 55, 0.2); color: var(--gold); padding: 10px; text-align: left; border-bottom: 2px solid var(--gold); font-family: 'Cinzel'; }
    td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 0.9rem; }
    .btn { cursor: pointer; border: none; padding: 5px 10px; border-radius: 4px; font-weight: bold; margin: 2px; }
    .edit-btn { background: var(--gold); color: black; }
    .del-btn { background: #9b111e; color: white; }
    
    /* Edit Modal Style */
    #editModal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#001f3f; border:2px solid var(--gold); padding:20px; border-radius:15px; z-index:100; width:300px; box-shadow: 0 0 50px black; }
    #editModal input { width:100%; margin:5px 0; padding:8px; border-radius:5px; border:1px solid var(--gold); background:transparent; color:white; }
  </style>
</head>
<body>
  <h1>Imperial Student Database</h1>
  
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Class</th>
          <th>Roll</th>
          <th>Father</th>
          <th>Aadhar</th>
          <th>Address</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="studentTableBody"></tbody>
    </table>
  </div>

  <div id="editModal">
    <h3 style="color:var(--gold); font-family:'Cinzel'">Edit Details</h3>
    <input type="hidden" id="editId">
    <input type="text" id="editName" placeholder="Name">
    <input type="text" id="editClass" placeholder="Class">
    <input type="text" id="editRoll" placeholder="Roll">
    <input type="text" id="editFather" placeholder="Father">
    <input type="text" id="editAadhar" placeholder="Aadhar">
    <input type="text" id="editAddress" placeholder="Address">
    <button class="btn edit-btn" onclick="updateData()">Save Changes</button>
    <button class="btn" onclick="document.getElementById('editModal').style.display='none'">Cancel</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyADzG1BL5PkDvEFDrqopdDY2BNl6jycDkQ",
      authDomain: "school-management-system-d210c.firebaseapp.com",
      projectId: "school-management-system-d210c",
      storageBucket: "school-management-system-d210c.firebasestorage.app",
      messagingSenderId: "78104585527",
      appId: "1:78104585527:web:9e25193d63f4d4fd1fe6b2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function loadData() {
      db.collection("students").orderBy("timestamp", "desc").onSnapshot((snap) => {
        const table = document.getElementById("studentTableBody");
        table.innerHTML = "";
        snap.forEach((doc) => {
          const s = doc.data();
          table.innerHTML += `<tr>
            <td>${s.name || '-'}</td>
            <td>${s.class || '-'}</td>
            <td>${s.rollNo || '-'}</td>
            <td>${s.father || '-'}</td>
            <td>${s.aadhar || '-'}</td>
            <td>${s.address || '-'}</td>
            <td>
              <button class="btn edit-btn" onclick="openEdit('${doc.id}', '${s.name}', '${s.class}', '${s.rollNo}', '${s.father}', '${s.aadhar}', '${s.address}')">Edit</button>
              <button class="btn del-btn" onclick="deleteData('${doc.id}')">Del</button>
            </td>
          </tr>`;
        });
      });
    }

    function openEdit(id, n, c, r, f, a, ad) {
      document.getElementById('editModal').style.display = 'block';
      document.getElementById('editId').value = id;
      document.getElementById('editName').value = n;
      document.getElementById('editClass').value = c;
      document.getElementById('editRoll').value = r;
      document.getElementById('editFather').value = f;
      document.getElementById('editAadhar').value = a;
      document.getElementById('editAddress').value = ad;
    }

    function updateData() {
      const id = document.getElementById('editId').value;
      db.collection("students").doc(id).update({
        name: document.getElementById('editName').value,
        class: document.getElementById('editClass').value,
        rollNo: document.getElementById('editRoll').value,
        father: document.getElementById('editFather').value,
        aadhar: document.getElementById('editAadhar').value,
        address: document.getElementById('editAddress').value
      }).then(() => {
        alert("Updated!");
        document.getElementById('editModal').style.display = 'none';
      });
    }

    function deleteData(id) {
      if(confirm("Are you sure?")) db.collection("students").doc(id).delete();
    }
    window.onload = loadData;
  </script>
</body>
</html>
