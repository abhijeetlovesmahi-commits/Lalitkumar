<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Imperial Admin | Lalit International School</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Poppins:wght@300;400;500&display=swap');
    :root { --gold: #D4AF37; --glass: rgba(255, 255, 255, 0.05); }
    body { margin: 0; font-family: 'Poppins', sans-serif; background: #000c1a; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
    
    #loginBox { margin-top: 100px; background: var(--glass); padding: 40px; border-radius: 20px; border: 1px solid var(--gold); text-align: center; }
    input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid var(--gold); background: transparent; color: white; box-sizing: border-box; }
    .btn-login { width: 100%; padding: 12px; background: var(--gold); color: black; border: none; font-weight: bold; border-radius: 8px; cursor: pointer; font-family: 'Cinzel'; }
    
    #adminContent { display: none; width: 95%; padding: 20px; }
    .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--gold); padding-bottom: 10px; }
    .tab-btn { background: transparent; color: var(--gold); border: 1px solid var(--gold); padding: 10px 20px; cursor: pointer; font-family: 'Cinzel'; border-radius: 5px; }
    .tab-btn.active { background: var(--gold); color: black; }

    .table-container { overflow-x: auto; display: none; }
    .table-container.active { display: block; }
    table { width: 100%; border-collapse: collapse; background: var(--glass); border: 1px solid var(--gold); }
    th { background: rgba(212, 175, 55, 0.2); color: var(--gold); padding: 10px; text-align: left; border-bottom: 2px solid var(--gold); font-family: 'Cinzel'; }
    td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 0.9rem; }
    
    .btn { cursor: pointer; border: none; padding: 5px 10px; border-radius: 4px; font-weight: bold; }
    .fee-paid { background: #046307; color: white; }
    .fee-pending { background: #cc8e35; color: white; }
    .att-p { background: #046307; color: white; } /* Present */
    .att-a { background: #9b111e; color: white; } /* Absent */
  </style>
</head>
<body>

  <div id="loginBox">
    <h2 style="font-family:'Cinzel'; color:var(--gold);">Imperial Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Enter Password">
    <button class="btn-login" onclick="checkPass()">ENTER DATABASE</button>
  </div>

  <div id="adminContent">
    <h1 style="font-family:'Cinzel'; color:var(--gold); text-align:center;">Imperial Management Dashboard</h1>
    
    <div class="nav-tabs">
      <button class="tab-btn active" onclick="switchTab('studentsTab', this)">Students & Fees</button>
      <button class="tab-btn" onclick="switchTab('attendanceTab', this)">Daily Attendance</button>
    </div>

    <div id="studentsTab" class="table-container active">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Class</th>
            <th>Roll</th>
            <th>Fees Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="studentTableBody"></tbody>
      </table>
    </div>

    <div id="attendanceTab" class="table-container">
      <h3 style="color:var(--gold)">Mark Attendance: <span id="currentDate"></span></h3>
      <table>
        <thead>
          <tr>
            <th>Roll</th>
            <th>Name</th>
            <th>Class</th>
            <th>Status (Click to toggle)</th>
          </tr>
        </thead>
        <tbody id="attendanceTableBody"></tbody>
      </table>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyADzG1BL5PkDvEFDrqopdDY2BNl6jycDkQ",
      authDomain: "school-management-system-d210c.firebaseapp.com",
      projectId: "school-management-system-d210c",
      storageBucket: "school-management-system-d210c.firebasestorage.app",
      messagingSenderId: "78104585527",
      appId: "1:78104585527:web:9e25193d63f4d4fd1fe6b2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function checkPass() {
      if(document.getElementById('adminPass').value === "Lalit@2026") {
        document.getElementById('loginBox').style.display = 'none';
        document.getElementById('adminContent').style.display = 'block';
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString();
        loadData();
      } else { alert("Wrong Password!"); }
    }

    function switchTab(tabId, btn) {
      document.querySelectorAll('.table-container').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      btn.classList.add('active');
    }

    function loadData() {
      db.collection("students").orderBy("rollNo", "asc").onSnapshot((snap) => {
        const studentTable = document.getElementById("studentTableBody");
        const attendanceTable = document.getElementById("attendanceTableBody");
        studentTable.innerHTML = "";
        attendanceTable.innerHTML = "";

        snap.forEach((doc) => {
          const s = doc.data();
          const feeStatus = s.fees || "Pending";
          const feeClass = feeStatus === "Paid" ? "fee-paid" : "fee-pending";
          const attStatus = s.attendance || "Absent";
          const attClass = attStatus === "Present" ? "att-p" : "att-a";

          // Tab 1 Data
          studentTable.innerHTML += `<tr>
            <td>${s.name}</td><td>${s.class}</td><td>${s.rollNo}</td>
            <td><button class="btn ${feeClass}" onclick="toggleFees('${doc.id}', '${feeStatus}')">${feeStatus}</button></td>
            <td><button class="btn att-a" style="background:#9b111e" onclick="deleteData('${doc.id}')">Del</button></td>
          </tr>`;

          // Tab 2 Data
          attendanceTable.innerHTML += `<tr>
            <td>${s.rollNo}</td><td>${s.name}</td><td>${s.class}</td>
            <td><button class="btn ${attClass}" onclick="toggleAttendance('${doc.id}', '${attStatus}')">${attStatus}</button></td>
          </tr>`;
        });
      });
    }

    function toggleFees(id, current) {
      db.collection("students").doc(id).update({ fees: current === "Paid" ? "Pending" : "Paid" });
    }

    function toggleAttendance(id, current) {
      db.collection("students").doc(id).update({ attendance: current === "Present" ? "Absent" : "Present" });
    }

    function deleteData(id) {
      if(confirm("Are you sure?")) db.collection("students").doc(id).delete();
    }
  </script>
</body>
</html>
