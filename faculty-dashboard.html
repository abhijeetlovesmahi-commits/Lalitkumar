<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Command Center | LIS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Poppins:wght@300;400;600&display=swap');

        :root {
            --primary-maroon: #4a0404;
            --gold: #D4AF37;
            --bg-light: #f0f2f5;
        }

        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background: var(--bg-light);
            display: flex;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px;
            height: 100vh;
            background: var(--primary-maroon); 
            color: white;
            padding: 25px;
            position: fixed;
            border-right: 4px solid var(--gold);
            z-index: 100;
        }

        .sidebar h2 {
            font-family: 'Cinzel', serif;
            color: var(--gold);
            text-align: center;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 15px;
        }

        .nav-link {
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            border-radius: 10px;
            transition: 0.3s;
            display: block;
            color: #eee;
            text-decoration: none;
            font-size: 0.9rem;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--gold);
            color: var(--primary-maroon);
            font-weight: bold;
        }

        .nav-link.admission-btn {
            border: 1px solid var(--gold);
            color: var(--gold);
            margin-top: 20px;
            text-align: center;
        }

        /* --- MAIN AREA --- */
        .main-area {
            margin-left: 310px;
            padding: 40px;
            width: calc(100% - 350px);
        }

        .content-section { display: none; }
        .content-section.active { display: block; }

        .faculty-header {
            background: white;
            padding: 20px 40px;
            border-radius: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            border-left: 8px solid var(--primary-maroon);
        }

        .faculty-header h1 { font-family: 'Cinzel'; font-size: 1.5rem; color: var(--primary-maroon); margin: 0; }

        /* --- DASHBOARD STYLES --- */
        .report-highlight {
            background: linear-gradient(45deg, var(--primary-maroon), #800000);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid var(--gold);
        }

        .report-highlight h2 { font-family: 'Cinzel'; color: var(--gold); margin: 0; }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .action-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            text-align: center;
            border-bottom: 4px solid var(--gold);
        }

        .action-btn {
            background: var(--primary-maroon);
            color: var(--gold);
            padding: 8px 12px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* --- FORM & TABLE STYLES --- */
        .form-wrap { background: white; padding: 30px; border-radius: 15px; margin-top: 20px; }
        .section-title { background: var(--primary-maroon); color: var(--gold); padding: 10px; margin: 20px 0; font-weight: bold; border-radius: 5px; }
        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .input-box { display: flex; flex-direction: column; }
        .input-box label { font-size: 12px; font-weight: bold; margin-bottom: 5px; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 5px; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
        th, td { border: 1px solid var(--primary-maroon); padding: 8px; text-align: center; }
        th { background: #f2e6d9; }

        .btn-download {
            background: var(--primary-maroon); color: var(--gold);
            padding: 15px 40px; border: 2px solid var(--gold);
            border-radius: 50px; font-weight: bold; cursor: pointer; margin-top: 30px;
        }

        /* --- PDF PRINT LAYOUT (HIDDEN) --- */
        #printable-report { 
            width: 1000px; padding: 50px; background: white; border: 15px double var(--primary-maroon); 
            position: absolute; left: -9999px; 
        }
        .header-main { display: flex; align-items: center; justify-content: space-between; border-bottom: 4px solid var(--primary-maroon); padding-bottom: 20px; }
        .stu-img { width: 110px; height: 130px; border: 3px solid var(--primary-maroon); object-fit: cover; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Faculty Portal</h2>
        <nav style="margin-top: 30px;">
            <button class="nav-link active" onclick="showSection('dash')">Dashboard Home</button>
            <button class="nav-link" onclick="showSection('report')">Report Card Generator</button>
            <a href="#" class="nav-link">Class Attendance</a>
            <a href="#" class="nav-link">Exam Marks Entry</a>
            <a href="admissionform.html" class="nav-link admission-btn">New Admission Form</a>
        </nav>
    </div>

    <div class="main-area">
        
        <div id="dash" class="content-section active">
            <div class="faculty-header">
                <h1>Imperial Command Center</h1>
                <button class="logout-btn" style="background:#000; color:var(--gold); border:2px solid var(--gold); padding:8px 20px; border-radius:20px;">Logout</button>
            </div>

            <div class="report-highlight">
                <div>
                    <h2>Exam Results Out!</h2>
                    <p>Generate & download official student report cards in PDF format.</p>
                </div>
                <button onclick="showSection('report')" style="background:var(--gold); color:var(--primary-maroon); padding:12px 25px; border-radius:30px; font-weight:bold; border:none; cursor:pointer;">Start Generating</button>
            </div>

            <div class="action-grid">
                <div class="action-card">
                    <h3>Admission</h3>
                    <p>Register Student</p>
                    <a href="admissionform.html" class="action-btn">Open Form</a>
                </div>
                <div class="action-card">
                    <h3>Students</h3>
                    <p style="font-size: 1.2rem; color: var(--primary-maroon); font-weight: bold;">1,240</p>
                    <a href="#" class="action-btn">View List</a>
                </div>
                <div class="action-card">
                    <h3>Assignments</h3>
                    <p style="font-size: 1.2rem; color: #9b111e; font-weight: bold;">12 Pending</p>
                    <a href="#" class="action-btn">Check</a>
                </div>
            </div>
        </div>

        <div id="report" class="content-section">
            <div class="faculty-header">
                <h1>Report Card Generator</h1>
                <button onclick="showSection('dash')" style="background:var(--primary-maroon); color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">Back to Dashboard</button>
            </div>

            <div class="form-wrap">
                <div class="section-title">1. Student Profile</div>
                <div class="grid-inputs">
                    <div class="input-box"><label>Student Name</label><input type="text" id="s_name"></div>
                    <div class="input-box"><label>Roll No.</label><input type="text" id="roll_no"></div>
                    <div class="input-box"><label>Class/Section</label><input type="text" id="class_sec"></div>
                    <div class="input-box"><label>Attendance (%)</label><input type="text" id="attendance"></div>
                    <div class="input-box"><label>Student Photo</label><input type="file" id="photo_input" accept="image/*"></div>
                </div>

                <div class="section-title">2. Scholastic Marks</div>
                <table id="main-entry-table">
                    <thead>
                        <tr>
                            <th rowspan="2">Subjects</th>
                            <th colspan="4">Term - 1 (100)</th>
                            <th colspan="4">Term - 2 (100)</th>
                        </tr>
                        <tr>
                            <th>PT</th><th>NB</th><th>SEA</th><th>Exam</th>
                            <th>PT</th><th>NB</th><th>SEA</th><th>Exam</th>
                        </tr>
                    </thead>
                    <tbody>
                        <script>
                            const subjects = ["Language 1", "Language 2", "Mathematics", "Science", "Social Science", "Computer"];
                            subjects.forEach((s) => {
                                document.write(`
                                    <tr>
                                        <td style="text-align:left; font-weight:bold;">${s}</td>
                                        <td><input type="number" class="t1_pt" style="width:40px" value="0"></td>
                                        <td><input type="number" class="t1_nb" style="width:40px" value="0"></td>
                                        <td><input type="number" class="t1_sea" style="width:40px" value="0"></td>
                                        <td><input type="number" class="t1_ex" style="width:40px" value="0"></td>
                                        <td><input type="number" class="t2_pt" style="width:40px" value="0"></td>
                                        <td><input type="number" class="t2_nb" style="width:40px" value="0"></td>
                                        <td><input type="number" class="t2_sea" style="width:40px" value="0"></td>
                                        <td><input type="number" class="t2_ex" style="width:40px" value="0"></td>
                                    </tr>
                                `);
                            });
                        </script>
                    </tbody>
                </table>

                <div class="section-title">3. Co-Scholastic</div>
                <div class="grid-inputs">
                    <div class="input-box"><label>Work Ed</label><input type="text" id="work_ed"></div>
                    <div class="input-box"><label>Art Ed</label><input type="text" id="art_ed"></div>
                    <div class="input-box"><label>Teacher Remarks</label><input type="text" id="remarks"></div>
                </div>

                <center><button class="btn-download" onclick="generatePDF()">Generate Final PDF Report</button></center>
            </div>
        </div>
    </div>

    <div id="printable-report">
        <div class="header-main">
            <div style="text-align: center; width: 100%;">
                <h1 style="font-family:'Cinzel'; color:#4a0404; font-size:35px; margin:0;">THE LALIT INTERNATIONAL SCHOOL</h1>
                <p>Report Card: Session 2026-27</p>
            </div>
            <img id="pdf_photo" class="stu-img" src="">
        </div>
        <div style="display: flex; justify-content: space-between; margin: 20px 0;">
            <p><strong>Name:</strong> <span id="r_name"></span></p>
            <p><strong>Class:</strong> <span id="r_class"></span></p>
            <p><strong>Roll:</strong> <span id="r_roll"></span></p>
        </div>
        <table id="pdf-table">
            <thead>
                <tr>
                    <th>SUBJECTS</th>
                    <th>TERM 1</th>
                    <th>TERM 2</th>
                    <th>GRAND TOTAL</th>
                    <th>GRADE</th>
                </tr>
            </thead>
            <tbody id="pdf-rows"></tbody>
        </table>
    </div>

    <script>
        function showSection(id) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function getGrade(m) {
            if(m >= 91) return "A1"; if(m >= 81) return "A2"; if(m >= 71) return "B1";
            if(m >= 33) return "D"; return "E";
        }

        document.getElementById('photo_input').onchange = (e) => {
            let reader = new FileReader();
            reader.onload = () => document.getElementById('pdf_photo').src = reader.result;
            reader.readAsDataURL(e.target.files[0]);
        };

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            document.getElementById('r_name').innerText = document.getElementById('s_name').value;
            document.getElementById('r_roll').innerText = document.getElementById('roll_no').value;
            document.getElementById('r_class').innerText = document.getElementById('class_sec').value;

            const pdfRows = document.getElementById('pdf-rows');
            pdfRows.innerHTML = "";
            const entryRows = document.querySelectorAll('#main-entry-table tbody tr');

            entryRows.forEach((row, i) => {
                const t1 = (parseFloat(row.querySelector('.t1_pt').value)||0) + (parseFloat(row.querySelector('.t1_nb').value)||0) + (parseFloat(row.querySelector('.t1_sea').value)||0) + (parseFloat(row.querySelector('.t1_ex').value)||0);
                const t2 = (parseFloat(row.querySelector('.t2_pt').value)||0) + (parseFloat(row.querySelector('.t2_nb').value)||0) + (parseFloat(row.querySelector('.t2_sea').value)||0) + (parseFloat(row.querySelector('.t2_ex').value)||0);
                pdfRows.innerHTML += `<tr><td>${subjects[i]}</td><td>${t1}</td><td>${t2}</td><td>${t1+t2}</td><td>${getGrade((t1+t2)/2)}</td></tr>`;
            });

            const report = document.getElementById('printable-report');
            report.style.position = "static";
            const canvas = await html2canvas(report, { scale: 2 });
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            pdf.addImage(imgData, 'PNG', 0, 0, 210, 297);
            pdf.save(`${document.getElementById('s_name').value}_Report.pdf`);
            report.style.position = "absolute";
        }
    </script>
</body>
</html>
